

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RL Toolkit &#8212; latest</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/fav32x32.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Distributed Toolkit" href="distributed_toolkit.html" />
    <link rel="prev" title="Business Engine" href="business_engine.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.svg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">latest</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   What is MARO?
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Installation
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/pip_install.html">
   Package
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/playground.html">
   Playground Docker Image
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/grass_cluster_provisioning_on_azure.html">
   Grass Cluster Provisioning on Azure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/k8s_cluster_provisioning_on_azure.html">
   K8S Cluster Provisioning on Azure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/grass_cluster_provisioning_on_premises.html">
   Grass Cluster Provisioning in On-Premises Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../installation/multi_processes_localhost_provisioning.html">
   Multi-processes Localhost Provisioning
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Scenarios
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../scenarios/container_inventory_management.html">
   Container Inventory Management (CIM)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scenarios/citi_bike.html">
   Bike Repositioning (Citi Bike)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../scenarios/vm_scheduling.html">
   Virtual Machine Scheduling (VM Scheduling)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Examples
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/multi_agent_dqn_cim.html">
   Multi Agent DQN for CIM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../examples/greedy_policy_citi_bike.html">
   Greedy Policy for Citi Bike
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Key Components
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="simulation_toolkit.html">
   Simulation Toolkit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data_model.html">
   Data Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="event_buffer.html">
   Event Buffer
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="business_engine.html">
   Business Engine
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   RL Toolkit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="distributed_toolkit.html">
   Distributed Toolkit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="communication.html">
   Distributed Communication
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="orchestration.html">
   Distributed Orchestration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dashboard_visualization.html">
   Dashboard Visualization
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  API Documents
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../apidoc/maro.html">
   maro package
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/key_components/rl_toolkit.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/microsoft/maro"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/microsoft/maro/issues/new?title=Issue%20on%20page%20%2Fkey_components/rl_toolkit.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/microsoft/maro/edit/master/doc/source/key_components/rl_toolkit.rst"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learner-and-actor">
   Learner and Actor
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#scheduler">
   Scheduler
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id1">
   Agent Manager
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   Agent
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id3">
   Algorithm
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#block-nnstack-and-learningmodel">
   Block, NNStack and LearningModel
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#explorer">
   Explorer
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="rl-toolkit">
<h1>RL Toolkit<a class="headerlink" href="#rl-toolkit" title="Permalink to this headline">¶</a></h1>
<p>MARO provides a full-stack abstraction for reinforcement learning (RL), which
empowers users to easily apply predefined and customized components to different
scenarios in a scalable way. The main abstractions include
<a class="reference external" href="#learner-and-actor">Learner, Actor</a>, <a class="reference external" href="#agent-manager">Agent Manager</a>,
<a class="reference external" href="#agent">Agent</a>, <a class="reference external" href="#algorithm">Algorithm</a>,
<a class="reference external" href="#shapers">State Shaper, Action Shaper, Experience Shaper</a>, etc.</p>
<div class="section" id="learner-and-actor">
<h2>Learner and Actor<a class="headerlink" href="#learner-and-actor" title="Permalink to this headline">¶</a></h2>
<a class="reference external image-reference" href="../images/rl/overview.svg"><img alt="RL Overview" src="../_images/overview1.svg" /></a>
<ul>
<li><p><strong>Learner</strong> is the abstraction of the learnable policy. It is responsible for
learning a qualified policy to improve the business optimized object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Train function of learner.</span>
<span class="k">def</span> <span class="nf">learn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">exploration_params</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scheduler</span><span class="p">:</span>
        <span class="n">performance</span><span class="p">,</span> <span class="n">exp_by_agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_actor</span><span class="o">.</span><span class="n">roll_out</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_agent_manager</span><span class="o">.</span><span class="n">dump_models</span><span class="p">(),</span>
            <span class="n">exploration_params</span><span class="o">=</span><span class="n">exploration_params</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scheduler</span><span class="o">.</span><span class="n">record_performance</span><span class="p">(</span><span class="n">performance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_manager</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">exp_by_agent</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Actor</strong> is the abstraction of experience collection. It is responsible for
interacting with the environment and collecting experiences. The experiences
collected during interaction will be used for the training of the learners.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rollout function of actor.</span>
<span class="k">def</span> <span class="nf">roll_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">epsilons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

    <span class="c1"># load models</span>
    <span class="k">if</span> <span class="n">model_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agents</span><span class="o">.</span><span class="n">load_models</span><span class="p">(</span><span class="n">model_dict</span><span class="p">)</span>

    <span class="c1"># load exploration parameters:</span>
    <span class="k">if</span> <span class="n">exploration_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agents</span><span class="o">.</span><span class="n">set_exploration_params</span><span class="p">(</span><span class="n">exploration_params</span><span class="p">)</span>

    <span class="n">metrics</span><span class="p">,</span> <span class="n">decision_event</span><span class="p">,</span> <span class="n">is_done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">is_done</span><span class="p">:</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agents</span><span class="o">.</span><span class="n">choose_action</span><span class="p">(</span><span class="n">decision_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">)</span>
        <span class="n">metrics</span><span class="p">,</span> <span class="n">decision_event</span><span class="p">,</span> <span class="n">is_done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agents</span><span class="o">.</span><span class="n">on_env_feedback</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

    <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agents</span><span class="o">.</span><span class="n">post_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">snapshot_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">return_details</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span> <span class="n">details</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="scheduler">
<h2>Scheduler<a class="headerlink" href="#scheduler" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">Scheduler</span></code> is the driver of an episodic learning process. The learner uses the scheduler to repeat the
rollout-training cycle a set number of episodes. For algorithms that require explicit exploration (e.g.,
DQN and DDPG), there are two types of schedules that a learner may follow:</p>
<ul class="simple">
<li><p>Static schedule, where the exploration parameters are generated using a pre-defined function of episode
number. See <code class="docutils literal notranslate"><span class="pre">LinearParameterScheduler</span></code> and <code class="docutils literal notranslate"><span class="pre">TwoPhaseLinearParameterScheduler</span></code> provided in the toolkit
for example.</p></li>
<li><p>Dynamic schedule, where the exploration parameters for the next episode are determined based on the performance
history. Such a mechanism is possible in our abstraction because the scheduler provides a <code class="docutils literal notranslate"><span class="pre">record_performance</span></code>
interface that allows it to keep track of roll-out performances.</p></li>
</ul>
<p>Optionally, an early stopping checker may be registered if one wishes to terminate training when certain performance
requirements are satisfied, possibly before reaching the prescribed number of episodes.</p>
</div>
<div class="section" id="id1">
<h2>Agent Manager<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>The agent manager provides a unified interactive interface with the environment
for RL agent(s). From the actor’s perspective, it isolates the complex dependencies
of the various homogeneous/heterogeneous agents, so that the whole agent manager
will behave just like a single agent. Furthermore, to well serve the distributed algorithm
(scalable), the agent manager provides two kinds of working modes, which can be applied in
different distributed components, such as inference mode in actor, training mode in learner.</p>
<a class="reference external image-reference" href="../images/rl/agent_manager.svg"><img alt="Agent Manager" src="../_images/agent_manager.svg" width="750" /></a>
<ul class="simple">
<li><p>In <strong>inference mode</strong>, the agent manager is responsible to access and shape
the environment state for the related agent, convert the model action to an
executable environment action, and finally generate experiences from the
interaction trajectory.</p></li>
<li><p>In <strong>training mode</strong>, the agent manager will optimize the underlying model of
the related agent(s), based on the collected experiences from in the inference mode.</p></li>
</ul>
</div>
<div class="section" id="id2">
<h2>Agent<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>An agent is a combination of (RL) algorithm, experience pool, and a set of
non-algorithm-specific parameters (algorithm-specific parameters are managed by
the algorithm module). Non-algorithm-specific parameters are used to manage
experience storage, sampling strategies, and training strategies. Since all kinds
of scenario-specific stuff will be handled by the agent manager, the agent is
scenario agnostic.</p>
<a class="reference external image-reference" href="../images/rl/agent.svg"><img alt="Agent" src="../_images/agent.svg" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AbsAgent</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="n">AbsAlgorithm</span><span class="p">,</span> <span class="n">experience_pool</span><span class="p">:</span> <span class="n">AbsStore</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_algorithm</span> <span class="o">=</span> <span class="n">algorithm</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">_experience_pool</span> <span class="o">=</span> <span class="n">experience_pool</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>Algorithm<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>The algorithm is the kernel abstraction of the RL formulation for a real-world problem. Our abstraction
decouples algorithm and model so that an algorithm can exist as an RL paradigm independent of the inner
workings of the models it uses to generate actions or estimate values. For example, the actor-critic
algorithm does not need to concern itself with the structures and optimizing schemes of the actor and
critic models. This decoupling is achieved by the <code class="docutils literal notranslate"><span class="pre">LearningModel</span></code> abstraction described below.</p>
<a class="reference external image-reference" href="../images/rl/algorithm.svg"><img alt="Algorithm" src="../_images/algorithm.svg" width="650" /></a>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">choose_action</span></code> is used to make a decision based on a provided model state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">train</span></code> is used to trigger training and the policy update from external.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AbsAlgorithm</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">LearningModel</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>
</pre></div>
</div>
</div>
<div class="section" id="block-nnstack-and-learningmodel">
<h2>Block, NNStack and LearningModel<a class="headerlink" href="#block-nnstack-and-learningmodel" title="Permalink to this headline">¶</a></h2>
<p>MARO provides an abstraction for the underlying models used by agents to form policies and estimate values.
The abstraction consists of a 3-level hierachy formed by <code class="docutils literal notranslate"><span class="pre">AbsBlock</span></code>, <code class="docutils literal notranslate"><span class="pre">NNStack</span></code> and <code class="docutils literal notranslate"><span class="pre">LearningModel</span></code> from
the bottom up, all of which subclass torch’s nn.Module. An <code class="docutils literal notranslate"><span class="pre">AbsBlock</span></code> is the smallest structural
unit of an NN-based model. For instance, the <code class="docutils literal notranslate"><span class="pre">FullyConnectedBlock</span></code> provided in the toolkit represents a stack
of fully connected layers with features like batch normalization, drop-out and skip connection. An <code class="docutils literal notranslate"><span class="pre">NNStack</span></code> is
a composite network that consists of one or more such blocks, each with its own set of network features.
The complete model as used directly by an <code class="docutils literal notranslate"><span class="pre">Algorithm</span></code> is represented by a <code class="docutils literal notranslate"><span class="pre">LearningModel</span></code>, which consists of
one or more task stacks as “heads” and an optional shared stack at the bottom (which serves to produce representations
as input to all task stacks). It also contains one or more optimizers responsible for applying gradient steps to the
trainable parameters within each stack, which is the smallest trainable unit from the perspective of a <code class="docutils literal notranslate"><span class="pre">LearningModel</span></code>.
The assignment of optimizers is flexible: it is possible to freeze certain stacks while optimizing others. Such an
abstraction presents a unified interface to the algorithm, regardless of how many individual models it requires and how
complex the model architecture might be.</p>
<a class="reference external image-reference" href="../images/rl/learning_model.svg"><img alt="Algorithm" src="../_images/learning_model.svg" width="650" /></a>
<p>As an example, the initialization of the actor-critic algorithm may look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">actor_stack</span> <span class="o">=</span> <span class="n">NNStack</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;actor&quot;</span><span class="p">,</span> <span class="n">block_a1</span><span class="p">,</span> <span class="n">block_a2</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">critic_stack</span> <span class="o">=</span> <span class="n">NNStack</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;critic&quot;</span><span class="p">,</span> <span class="n">block_c1</span><span class="p">,</span> <span class="n">block_c2</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">learning_model</span> <span class="o">=</span> <span class="n">LearningModel</span><span class="p">(</span><span class="n">actor_stack</span><span class="p">,</span> <span class="n">critic_stack</span><span class="p">)</span>
<span class="n">actor_critic</span> <span class="o">=</span> <span class="n">ActorCritic</span><span class="p">(</span><span class="n">learning_model</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
<p>Choosing an action is simply:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">learning_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">task_name</span><span class="o">=</span><span class="s2">&quot;actor&quot;</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>And performing one gradient step is simply:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">learning_model</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span><span class="n">critic_loss</span> <span class="o">+</span> <span class="n">actor_loss</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="explorer">
<h2>Explorer<a class="headerlink" href="#explorer" title="Permalink to this headline">¶</a></h2>
<p>MARO provides an abstraction for exploration in RL. Some RL algorithms such as DQN and DDPG require
explicit exploration, the extent of which is usually determined by a set of parameters whose values
are generated by the scheduler. The <code class="docutils literal notranslate"><span class="pre">AbsExplorer</span></code> class is designed to cater to these needs. Simple
exploration schemes, such as <code class="docutils literal notranslate"><span class="pre">EpsilonGreedyExplorer</span></code> for discrete action space and <code class="docutils literal notranslate"><span class="pre">UniformNoiseExplorer</span></code>
and <code class="docutils literal notranslate"><span class="pre">GaussianNoiseExplorer</span></code> for continuous action space, are provided in the toolkit.</p>
<p>As an example, the exploration for DQN may be carried out with the aid of an <code class="docutils literal notranslate"><span class="pre">EpsilonGreedyExplorer</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">explorer</span> <span class="o">=</span> <span class="n">EpsilonGreedyExplorer</span><span class="p">(</span><span class="n">num_actions</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">greedy_action</span> <span class="o">=</span> <span class="n">learning_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="n">exploration_action</span> <span class="o">=</span> <span class="n">explorer</span><span class="p">(</span><span class="n">greedy_action</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="business_engine.html" title="previous page">Business Engine</a>
    <a class='right-next' id="next-link" href="distributed_toolkit.html" title="next page">Distributed Toolkit</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By MARO Team<br/>
        
            &copy; Copyright 2020 Microsoft.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>